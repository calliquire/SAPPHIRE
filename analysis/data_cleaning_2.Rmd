---
title: "data_cleaning_2"
author: "calliquire"
date: "2024-10-03"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

**About This Analysis:** This is the second iteration of data cleaning that must be done after data_cleaning_1. Here, I clean the screening_long long-form dataset to have columns for body_site and reflectance_type (as well as collection_period, which was done in data_cleaning_1).

## Set Up

1. Load the relevant packages.
```{r, message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
```

2. Load the data.
```{r}
data <- read.csv("data/screening_long.csv")
```

## Reshape and Clean Data

3. Reshaping the data to include each reflectance value in its own row, with separate columns for body site and reflectance type. This will create a long format dataset with two new columns:
-   Measurement: Contains the original column names (e.g., skin_reflectance_forehead_M1).
-   Reflectance: Contains the reflectance values.
```{r}
data_long <- pivot_longer(data, 
                          cols = starts_with("skin_reflectance"), 
                          names_to = "measurement", 
                          values_to = "reflectance")
```

4. Extract body site and reflectance type data from the new measurement column. 
```{r}
data_long <- data_long %>%
  extract(col = "measurement",
          into = c("body_site", "reflectance_type"),
          regex = "skin_reflectance_([a-zA-Z_]+?)(l[123]|l_[123]|a[123]|a_[123]|b[123]|b_[123]|g[123]|r[123]|m[123]|e[123])",
          remove = FALSE) %>%
  mutate(body_site = gsub("_$", "", body_site))  # Remove any trailing underscore from body_site
```

5. Delete the "measurements" column since it is no longer needed.
```{r}
data_long <- data_long %>%
  select(-measurement)
```

6. Save the cleaned data file.
```{r}
write.csv(data_long, "data/cleaned_screening_long.csv", row.names = FALSE)
```
