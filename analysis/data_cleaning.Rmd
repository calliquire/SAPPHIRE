---
title: "data_cleaning"
author: "calliquire"
date: "2024-10-01"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

**About This Analysis:** The goal of this analysis is to initiate the wrangling of the original, raw data through manual editing in Google Sheets and a R pipeline to leave us with three long-form data sets (one for each category of data).

## Set Up

1.  Load the relevant packages.

```{r}
library(readxl)
library(dplyr)
library(janitor)
library(tidyverse)
```

## Prepare Your Data

2.  In Google Sheets, make a copy of the original data, save that copy as "serum_vit_D_study_with_lab_results.xlsx" and manually edit the following:

-   delete floating note in ScreeningDataCollectionWinter sheet: "Note: VDKH001 had no second weight measurement so the initial measurement was used."
-   delete floating note in ScreeningDataCollection6Weeks sheet: "Note: VDKH007 and VDKH012 had no second weight measurement so the initial measurement was used."
-   change column DT name in ScreeningDataCollectionWinter sheet from "Result" to "VitDResult" to match the same measures in the Summer and 6 Weeks sheets
-   delete columns A and B (named ParticipantID and ParticipantCentre, respectively) so that column C becomes your unique identifier (named ParticipantCentreID) in all of the individual sheets within the workbook
-   delete floating notes in FoodFrequencySummer sheet: "Notes: VDKH016 - No information for Pilchards or Liver beef/lamb; VDTG011 - No Vit D for Marg soft."
-   delete floating notes in FoodFrequencyWinter sheet: "Note: No amounts calculated for VDKH047 - Soft Marg - or VDKH050 - Snoek; Where two types of margerine were specified, the brand with the lower Vit D percentage was used to calculate Vit D ie VDTG023, 032,045"

## Begin Wrangling in R

3.  Specify the path to the new Excel file. This .xlsx file is located in \~/GitHub/SAPPHIRE/data.

```{r}
file_path <- "data/serum_vit_D_study_with_lab_results.xlsx"
```

### Category 1: Screening Data Collection

4.  Load data from the Screening Data Collection sheets.

```{r}
screening_summer <- read_excel(file_path, sheet = "ScreeningDataCollectionSummer")
screening_winter <- read_excel(file_path, sheet = "ScreeningDataCollectionWinter")
screening_6weeks <- read_excel(file_path, sheet = "ScreeningDataCollection6Weeks")
```

5.  Convert the column names to snake_case.

```{r}
screening_summer <- screening_summer %>% clean_names()
screening_winter <- screening_winter %>% clean_names()
screening_6weeks <- screening_6weeks %>% clean_names()
```

6.  Standardize the data types for critical columns, for example, age_years.

```{r}
screening_summer <- screening_summer %>% mutate(age_years = as.numeric(age_years))
screening_winter <- screening_winter %>% mutate(age_years = as.numeric(age_years))
screening_6weeks <- screening_6weeks %>% mutate(age_years = as.numeric(age_years))
```

7.  Add a 'collection_period' column to each data frame to indicate when the data was collected.

```{r}
screening_summer <- screening_summer %>% mutate(collection_period = "Summer")
screening_winter <- screening_winter %>% mutate(collection_period = "Winter")
screening_6weeks <- screening_6weeks %>% mutate(collection_period = "6Weeks")
```

8.  Combine the dataframes into a long-form dataset.

```{r}
screening_long <- bind_rows(screening_summer, screening_winter, screening_6weeks)
```

9.  View the resulting long-form dataset

```{r}
print(head(screening_long))
```

***Repeat the above steps for the sheets in the Food Frequency category and in the Sun Exposure category.***

### Category 2: Food Frequency

4.  Load data from the Food Frequency sheets.

```{r}
food_freq_summer <- read_excel(file_path, sheet = "FoodFrequencySummer")
food_freq_winter <- read_excel(file_path, sheet = "FoodFrequencyWinter")
food_freq_6weeks <- read_excel(file_path, sheet = "FoodFrequency6Weeks")
```

5.  Convert the column names to snake_case.

```{r}
food_freq_summer <- food_freq_summer %>% clean_names()
food_freq_winter <- food_freq_winter %>% clean_names()
food_freq_6weeks <- food_freq_6weeks %>% clean_names()
```

6.  Step 6 unnecessary.

7.  Add a 'collection_period' column to each data frame to indicate when the data was collected.

```{r}
food_freq_summer <- food_freq_summer %>% mutate(collection_period = "Summer")
food_freq_winter <- food_freq_winter %>% mutate(collection_period = "Winter")
food_freq_6weeks <- food_freq_6weeks %>% mutate(collection_period = "6Weeks")
```

8.  Combine the dataframes into a long-form dataset.

```{r}
food_freq_long <- bind_rows(food_freq_summer, food_freq_winter, food_freq_6weeks)
```

9.  View the resulting long-form dataset

```{r}
print(head(food_freq_long))
```

### Category 3: Sun Exposure

4.  Load data from the Sun Exposure sheets.

```{r}
sun_expos_summer <- read_excel(file_path, sheet = "SunExposureSummer")
sun_expos_winter <- read_excel(file_path, sheet = "SunExposureWinter")
sun_expos_6weeks <- read_excel(file_path, sheet = "SunExposure6Weeks")
```

5.  Convert the column names to snake_case.

```{r}
sun_expos_summer <- sun_expos_summer %>% clean_names()
sun_expos_winter <- sun_expos_winter %>% clean_names()
sun_expos_6weeks <- sun_expos_6weeks %>% clean_names()
```

6.  Step 6 unnecessary.

7.  Add a 'collection_period' column to each data frame to indicate when the data was collected.

```{r}
sun_expos_summer <- sun_expos_summer %>% mutate(collection_period = "Summer")
sun_expos_winter <- sun_expos_winter %>% mutate(collection_period = "Winter")
sun_expos_6weeks <- sun_expos_6weeks %>% mutate(collection_period = "6Weeks")
```

8.  Combine the dataframes into a long-form dataset.

```{r}
sun_expos_long <- bind_rows(sun_expos_summer, sun_expos_winter, sun_expos_6weeks)
```

9.  View the resulting long-form dataset

```{r}
print(head(sun_expos_long))
```
