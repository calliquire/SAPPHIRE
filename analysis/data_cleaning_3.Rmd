---
title: "data_cleaning_3"
author: "calliquire"
date: "2024-10-07"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

**About This Analysis:** This is the third iteration of data cleaning that must be done after data_cleaning_2. 

## Overview
-   Handling Missing Values.
-   Converting Categorical Variables to Factors.
-   Reshaping or Filtering the Data (if necessary).
-   Removing Unnecessary Columns.

Load relevant libraries.
```{r, message=FALSE, warning=FALSE}
# Load necessary libraries
library(dplyr)
```

Read in the data.
```{r}
df <- read.csv("data/cleaned_screening_long.csv")
```

Check for missing values.
```{r}
# Check for missing values
missing_summary <- sapply(df, function(x) sum(is.na(x)))
print(missing_summary)
```

Create column for ethnicity (xhosa or cape_mixed). If participants answered TRUE to ethnicity_african_black, and FALSE to all other ethnicity_ questions, they are designated as xhosa. If participants answered TRUE to ethnicity_coloured and FALSE to all other ethnicity_ questions, they are designated as cape_coloured.
```{r}
# Create the ethnicity column based on conditions
df <- df %>%
  mutate(ethnicity = case_when(
    ethnicity_african_black == TRUE & 
    ethnicity_coloured == FALSE & 
    ethnicity_white == FALSE & 
    ethnicity_indian_asian == FALSE & 
    ethnicity_other == FALSE ~ "xhosa",
    
    ethnicity_coloured == TRUE & 
    ethnicity_african_black == FALSE & 
    ethnicity_white == FALSE & 
    ethnicity_indian_asian == FALSE & 
    ethnicity_other == FALSE ~ "cape_coloured",
    
    TRUE ~ NA_character_  # Assign NA for all other cases
  ))

# Fill NA values with 'Other' if needed
df$ethnicity[is.na(df$ethnicity)] <- "Other"

# Check the updated dataframe
head(df)
```

Covert categorical variables into factors.
```{r}
df$body_site <- factor(df$body_site)
df$collection_period <- factor(df$collection_period)
df$reflectance_metric <- factor(df$reflectance_metric)
df$ethnicity <- factor(df$ethnicity)
```

Check structure of data frame.
```{r}
str(df)
```

Remove columns that are irrelevant to the analysis. Do this through filtering for the columns that are relevant.
```{r}
df_filtered <- df %>%
  select(participant_centre_id, gender, ethnicity, 
         vit_d_result, collection_period, body_site, 
         reflectance_metric, reflectance_value)
```



