---
title: "data_modeling_1"
author: "calliquire"
date: "2024-10-03"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

**About This Analysis:** The goal of this analysis is to fit a Linear Mixed Effects Model to the cleaned and filtered data set.

## Set Up
0. Install package.
```{r}
install.packages("viridis")
```

1.  Load the data.
```{r}
data <- read.csv("data/filtered_screening_long.csv")
```

2.  Load relevant libraries.
```{r, message=FALSE, warning=FALSE}
library(lme4)
library(dplyr)
library(ggplot2)
library(viridis)
```

3.  Fit the Linear Mixed Effects Model.

-   Fixed effects for reflectance metrics, body sites, and collection periods.
-   Random effects for individuals and body sites.
Note in this model: 
-   reflectance_value: The response variable.
-   reflectance_metric: The fixed effect representing the different metrics.
-   collection_period: The fixed effect for time (Summer, Winter, etc.).
-   (1 | individual_id): Random intercept for each individual.
-   (1 | body_site): Random intercept for each body site (optional).
```{r}
model <- lmer(reflectance_value ~ reflectance_metric * collection_period + (1 | participant_centre_id) + (1 | body_site), data = data)
```

4. Check the model summary.
```{r}
View(model)
```

5. Calculate the estimated marginal means for the interaction between reflectance_metric and collection_period. This gives the predicted means for each reflectance metric at each collection period.
```{r}
emm <- emmeans(model, ~ reflectance_metric * collection_period)
```

6. Convert the results to a data frame for plotting
```{r}
emm_df <- as.data.frame(emm)
```

7. Visualize the results. Create a faceted plot to see each reflectance metric separately.
```{r}
custom_palette <- viridis(24)

ggplot(emm_df, aes(x = collection_period, y = emmean, color = reflectance_metric, group = reflectance_metric)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Estimated Marginal Means of Reflectance Values by Collection Period", 
       x = "Collection Period", 
       y = "Estimated Reflectance Value") +
  scale_color_manual(values = custom_palette)  # Use your custom palette
```


